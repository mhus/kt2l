"use strict";(self.webpackChunkKT2L=self.webpackChunkKT2L||[]).push([[5173],{1726:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>i,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var n=t(5893),o=t(1151);const a={sidebar_position:11,title:"Background Tasks"},c="Background Tasks",r={id:"contribute/background-tasks",title:"Background Tasks",description:"To provide cluster related tasks in the background we use a system to run tasks in the background. If all tabs for",source:"@site/docs/contribute/background-tasks.md",sourceDirName:"contribute",slug:"/contribute/background-tasks",permalink:"/docs/contribute/background-tasks",draft:!1,unlisted:!1,editUrl:"https://github.com/mhus/kt2l/blob/main/docs/docs/contribute/background-tasks.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{sidebar_position:11,title:"Background Tasks"},sidebar:"tutorialSidebar",previous:{title:"Cluster Actions",permalink:"/docs/contribute/cluster-action"},next:{title:"Resource Actions",permalink:"/docs/contribute/resource-action"}},i={},d=[{value:"How to implement a background task",id:"how-to-implement-a-background-task",level:2},{value:"How to use background jobs",id:"how-to-use-background-jobs",level:2}];function l(e){const s={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{id:"background-tasks",children:"Background Tasks"}),"\n",(0,n.jsx)(s.p,{children:"To provide cluster related tasks in the background we use a system to run tasks in the background. If all tabs for\na cluster are closed this tasks will be removed from the background task system. The most common use case is to\nwatch the cluster for changes of resources."}),"\n",(0,n.jsx)(s.p,{children:"Only one instance of a background task is running for a cluster. Use Background Tasks only if it makes sense to have\na singleton instance for a cluster. The job will live as long as the cluster is open in the UI."}),"\n",(0,n.jsx)(s.h2,{id:"how-to-implement-a-background-task",children:"How to implement a background task"}),"\n",(0,n.jsxs)(s.p,{children:["To register a new Background Task you need to call the ",(0,n.jsx)(s.code,{children:"getBackgroundJob"})," method of the ",(0,n.jsx)(s.code,{children:"Core"})," class and\nprovide a creator lambda. The creator lambda will be called if the background task is not running for the cluster."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:"core.getBackgroundJob(clusterConfig.name(), ClusterNodeWatch.class, () -> new ClusterNodeWatch())\n"})}),"\n",(0,n.jsxs)(s.p,{children:["Best practice is to use ",(0,n.jsx)(s.code,{children:"backgroundJobInstance()"})," method to get the instance of the background task."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:"var job = core.backgroundJobInstance(cluster, ClusterNodeWatch.class);\n"})}),"\n",(0,n.jsxs)(s.p,{children:["The Background Task class must extend from abstract ",(0,n.jsx)(s.code,{children:"ClusterBackgroundJob"})," but in the most cases from\n",(0,n.jsx)(s.code,{children:"AbstractClusterWatch"})," is a better choice. The ",(0,n.jsx)(s.code,{children:"AbstractClusterWatch"})," class simplifies the implementation\nof a background task."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:"public abstract class AbstractClusterWatch<V1Namespace> {\n\n}\n"})}),"\n",(0,n.jsx)(s.h2,{id:"how-to-use-background-jobs",children:"How to use background jobs"}),"\n",(0,n.jsxs)(s.p,{children:["Background job is a special kind of background task and is managed by the ",(0,n.jsx)(s.code,{children:"BackgroundJobDialogRegistry"})," class.\nA background job is always a graphical progress dialog. You can create it by using the ",(0,n.jsx)(s.code,{children:"BackgroundJobDialog"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["If you allow canceling you should check the ",(0,n.jsx)(s.code,{children:"isCanceled()"})," method to stop the job properly."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:'var dialog = new BackgroundJobDialog(core, cluster, true);\ndialog.setHeaderTitle("My Background Job");\ndialog.open();\n\nThread.startVirtualThread(() ->{\n        while(!dialog.isCanceled()){\n        // do something\n        }\n        context.getUi().access(()->dialog.close());\n});\n'})})]})}function u(e={}){const{wrapper:s}={...(0,o.a)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},1151:(e,s,t)=>{t.d(s,{Z:()=>r,a:()=>c});var n=t(7294);const o={},a=n.createContext(o);function c(e){const s=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),n.createElement(a.Provider,{value:s},e.children)}}}]);