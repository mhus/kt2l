"use strict";(self.webpackChunkKT2L=self.webpackChunkKT2L||[]).push([[5173],{1726:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var s=n(5893),a=n(1151);const o={sidebar_position:11,title:"Background Tasks"},r="Background Tasks",c={id:"contribute/background-tasks",title:"Background Tasks",description:"To provide cluster related tasks in the background we use a system to run tasks in the background. If all tabs for",source:"@site/docs/contribute/background-tasks.md",sourceDirName:"contribute",slug:"/contribute/background-tasks",permalink:"/docs/contribute/background-tasks",draft:!1,unlisted:!1,editUrl:"https://github.com/mhus/kt2l/blob/main/docs/docs/contribute/background-tasks.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{sidebar_position:11,title:"Background Tasks"},sidebar:"tutorialSidebar",previous:{title:"Cluster Actions",permalink:"/docs/contribute/cluster-action"},next:{title:"Resource Actions",permalink:"/docs/contribute/resource-action"}},i={},l=[{value:"How to implement a background task",id:"how-to-implement-a-background-task",level:2}];function d(e){const t={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,a.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"background-tasks",children:"Background Tasks"}),"\n",(0,s.jsx)(t.p,{children:"To provide cluster related tasks in the background we use a system to run tasks in the background. If all tabs for\na cluster are closed this tasks will be removed from the background task system. The most common use case is to\nwatch the cluster for changes of resources."}),"\n",(0,s.jsx)(t.p,{children:"Only one instance of a background task is running for a cluster. Use Background Tasks only if it makes sense to have\na singleton instance for a cluster. The job will live as long as the cluster is open in the UI."}),"\n",(0,s.jsx)(t.h2,{id:"how-to-implement-a-background-task",children:"How to implement a background task"}),"\n",(0,s.jsxs)(t.p,{children:["To register a new Background Task you need to call the ",(0,s.jsx)(t.code,{children:"getBackgroundJob"})," method of the ",(0,s.jsx)(t.code,{children:"Core"})," class and\nprovide a creator lambda. The creator lambda will be called if the background task is not running for the cluster."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",children:"core.getBackgroundJob(clusterConfig.name(), ClusterNodeWatch.class, () -> new ClusterNodeWatch())\n"})}),"\n",(0,s.jsx)(t.p,{children:"Best practice is to provide a static instance() method to get the instance of the background task."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",children:"public static ClusterNodeWatch instance(Core core, Cluster clusterConfig) {\n    return core.getBackgroundJob(clusterConfig.name(), ClusterNodeWatch.class, () -> new ClusterNodeWatch());\n}\n"})}),"\n",(0,s.jsx)(t.p,{children:"and deny the creation of the class with a private constructor."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",children:"private ClusterNodeWatch() {\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The Background Task class must extend from abstract ",(0,s.jsx)(t.code,{children:"ClusterBackgroundJob"})," class."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",children:"public abstract class ClusterBackgroundJob {\n    public abstract void close();\n    public abstract void init(Core core, String clusterId, String jobId) throws IOException;\n}\n"})})]})}function u(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>c,a:()=>r});var s=n(7294);const a={},o=s.createContext(a);function r(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);